# Dockerfile для Django-приложения

# 1. Базовый образ
# Мы берем официальный образ Python 3.11, он легкий и быстрый.
FROM python:3.11-slim

# 2. Устанавливаем переменные окружения
ENV PYTHONDONTWRITEBYTECODE 1  # Говорим Python не создавать .pyc файлы
ENV PYTHONUNBUFFERED 1         # Выводим логи сразу в консоль

# 3. Устанавливаем рабочую директорию внутри контейнера
WORKDIR /app

# 4. Копируем файл с зависимостями и устанавливаем их
# Этот шаг кэшируется, чтобы не переустанавливать все каждый раз
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 5. Копируем весь остальной код нашего приложения
COPY . .

# 6. Указываем порт, на котором будет работать Gunicorn
EXPOSE 8080

# 7. Команда для запуска приложения
# Google Cloud Run автоматически подставит переменную $PORT
CMD ["gunicorn", "backend.wsgi", "--bind", "0.0.0.0:$PORT"]